<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<title>商品详情</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<link href="css/reset.css" rel="stylesheet"/>	
  <link rel="stylesheet" href="css/iconfont.css">
	<link rel="stylesheet" type="text/css" href="css/details.css"/>
	<link rel="stylesheet" type="text/css" href="css/swiper-3.3.1.min.css"/>
	<script type="text/javascript" src="js/fontsize.js"></script>
</head>
<body>
  <!--头部 header-->
  <header>
  	<div class="header">
  		<i class="icon icon-return"></i>
  		<h1 class="cl">
  			图文详情
  		</h1>
      <em class="fenxiang"></em>
  	</div>
  </header>
  <div style="height:46px;"></div>
  <section>
   <div class="hy_cont">
    <div class="swiper-container">
      <div class="swiper-wrapper">
          <!-- <div class="swiper-slide">
          	<a href="javascript:;">
          		<img src="images/shop_06.jpg">
          	</a>
          </div> -->
      </div>
      <div class="swiper-pagination">1111</div>
  </div>
  <div class="hy_detail"> 
     <!-- <h2>汤臣倍健 鱼油软胶囊1000mg*100粒</h2>
     <em>￥<i>490</i></em>
     <p class="cl"><span>￥49.00</span><span>7.0折</span></p>
     <i>自营</i>
     <div>
         <a>正品保证</a><a>满69.0元包邮</a>
     </div> -->
  </div>
   </div>
   <p style="height: .2rem;background:#f7f7f7;"></p>
   <div class="hy_search"><em>></em></div>
   <p style="height: .2rem;background:#f7f7f7;"></p>
  <!--图文详情-->
  <div class="hy_pickList">
  <div class="hy_list">
   <ul class="cl">
     	 <li class="over">图文详情</li>
     	 <li>规格参数</li>
     </ul>
   <div class="hy_Img">
   	 <!-- <img src="images/shop_13.jpg"> -->
   </div>
  </div>
  <div class="hy_stand"   style="display:none">
    <!-- <h2>汤臣倍健</h2> -->
   <!-- <table>
   	<tr>
      <th colspan="3">请仔细阅读产品说明书并按说明使用</th>
    </tr>
    <tr>
      <td class="t">商品名称</td>
      <td>汤臣倍健 鱼油胶囊1000mg*100粒</td>
    </tr>
    <tr>
      <td class="t">商品名称</td>
      <td>汤臣倍健 鱼油胶囊1000mg*100粒</td>
    </tr>
    <tr>
      <td class="t">商品名称</td>
      <td>汤臣倍健 鱼油胶囊1000mg*100粒</td>
    </tr>
    <tr>
      <td class="t">商品名称</td>
      <td>汤臣倍健 鱼油胶囊1000mg*100粒</td>
    </tr>
    <tr>
      <td class="t">商品名称</td>
      <td>汤臣倍健 鱼油胶囊1000mg*100粒</td>
    </tr>
   </table> -->
  </div>
  </div>
  </section>
  <footer class="hy_ft">
  	<ul>
  		<li>
  		  <img src="images/shop_17.jpg">
  		  <a href="tel:4006070099">客服</a>
  		</li>
  		<li style="position: relative;" onclick="shop(this)">
  		    <img src="images/shop_19.jpg">
  			  <a href="javascript:;">购物车</a>
          <i class="num"></i>
  		</li>
  		<li class="add">加入购物车</li>
  		<li onclick="shop(this)" id="purchase">立即购买</li>
  	</ul>
  </footer>
  <!-- <div class="bottom_fenxiang">
    <div class="bottom_fenxiang">
    <ul>
      <li><img src=""/><span>微信好友</span></li>
      <li><img src=""/><span>胖友圈</span></li>
      <li><img src=""/><span>QQ好友</span></li>
      <li><img src=""/><span>QQ空间</span></li>
      <li><img src=""/><span>新浪微博</span></li>
      <li><img src=""/><span>腾讯微博</span></li>
      <li><img src=""/><span>短信</span></li>
    </ul>
    <input type="buttom" value="取消"/>
  </div>
  </div> -->
<script src="js/zepto.min.js" type="text/javascript"></script>
<script src="js/swiper-3.3.1.min.js"></script>
<!-- <script src="js/iscroll.js"></script> -->
<script type="text/javascript" src="../js/base.js"></script>
<script>
   // cookie
   //delCookie('customerid')
   var mipa,customerid;
   var customerid1 = getparam().customerid;
   var customerid2 = getCookie('customerid');
 
   mipa = getCookie('url'); 
   if ( customerid1 == (null)) {
        customerid1 = '';
        setCookie('customerid',customerid1);
   }

   if (customerid1) {
         customerid = customerid1;
         setCookie('customerid',customerid1);
        //alert('111'+customerid)
   }

   if (customerid2) { 
       customerid = customerid2;
       setCookie('customerid',customerid2);
       //alert('222'+customerid)
  }


   var nav_lis=$('.hy_list ul li');
   var address = location.href;// url
   $('.num').text(getparam().num);
   //图文 规格 table  切换
   nav_lis.on('click',function () {
      $(this).addClass('over').siblings().removeClass('over');
      if($(this).index()==0){
         $('.hy_stand').hide();
         $('.hy_Img').show();
      }else{
         $('.hy_stand').show();
         $('.hy_Img').hide();
      }
   });


 //点击购物车
  function shop(obj){
    if($(obj).text() == '立即购买'){
      var prdid = $(obj).attr('data');
      var num = $(obj).attr('num');
      var price = $('.price span').eq(0).attr('price');
      if( customerid) {
            
           location.href = '/order/html/order.html?prdid='+prdid+'&price='+price+"&num=1";
       
         } else if( customerid == null || typeof(customerid) == undefined || customerid == 'none' || customerid == '') {

           location.href = 'oasis://login?url='+address+'&';
      }

    } else {

        if( customerid ){
            window.location.href='/order/purchase.html?customerid='+customerid+'&sectionsid='+getparam().sectionsid+'&txt='+getparam().txt+'&section='+getparam().section;

          }else if( customerid == null || customerid == 'undefined' || customerid == 'none' || customerid == '') {

               location.href = 'oasis://login?url='+address+'&';
          }
            
       }
  };
         
    //判断是通过商品展示还是通过活动id展示
 
    var myurl,mydata,id,sectionsid
    /*id = getparam().id||0;
    sectionsid = getparam().sectionsid;*/
    if(!getparam().prdid){
    	myurl = "/testback/fast/getActfromMat";
    	mydata = 'info={sectionsid:'+getparam().sectionsid+'}';
    }else{
    	myurl = "/testback/fast/getMatfromAct";
    	mydata ="info={prdid:'" + getparam().prdid + "'}";
    }
   
   $.ajax({
        type : "post",
        url : myurl, // 请求的地址
        data :mydata,
        dataType : "json",
        success : function(data){
          console.log(data)
         if(data.code == 0 ){
           //规格参数
           $.each(data.declares,function(n,b) {
              var index=$.trim(b.declares).replace(/：/ig,':').split(':');
              if(n == 0){
                 $('<table><tr><th colspan="3">请仔细阅读产品说明书并按说明使用</th></tr></table>').appendTo($('.hy_stand'));
              }else{
                $('<tr><td class="t">'+index[0]+'</td><td>'+index[1]+'</td></tr>').appendTo($('.hy_stand table'));
              }
           });  
             //====
               function guige(){
                //分享
                  /*var isapp = getBrowser().isapp;
                  if(isapp){
                    $('.fenxiang').css('display','inline').on('click',function(){
                      location.href = 'oasis://share&&&' + encodeURIComponent(data.prdMat.name) + '&&&' + encodeURIComponent(data.prdMat.applisymp) + '&&&' +encodeURIComponent(location.href) + '';
                    })
                  }*/
                  $('.fenxiang').share(data.prdMat.name,data.prdMat.applisymp,location.href);
                //包邮
                 $.post('/testback/prdOrder/getFullCut',function(data){
                    $('.baoyou span').text(data.prdFullcut.fullcut);
                 },'json');
                 //规格
                 $.each(data.unitlist,function(i,obj){
                    var prdid = data.unitlist[i].prdid;
                    var starnderdesc = data.unitlist[i].starnderdesc;
                    $(".guige").append("<span data-prdid='"+prdid+"'>"+starnderdesc+"</span>")

                 })
                 
                 //旗舰店
                  $(".hy_search").text(data.supdetail.supname).attr("data-supid",data.supdetail.supid).append("<em>></em>"); 
                  $(".hy_search").on("click",function(){
                    var supid = $(this).attr("data-supid");
                    /*$.post(
                      "/testback/fast/getSearch",
                     "info={searchStr:'',count:5,pagenum:1,orderby:1,supid:"+supid+"}",
                     function(d){
                      console.log(d)*/
                        window.location.href="qjd_list.html?supid="+supid;
                  //   })
                   
                  })   
               }
               var countnum = data.prdMat.countnum;//销量
           // 商品 名称  价格 
           if(data.sections){
              $('.add').attr('data',data.prdMat.prdid);
              $('#shop').attr('data',data.prdMat.prdid);
              $('#purchase').attr('data',data.prdMat.prdid);
              /*$('<div class="swiper-slide"><img src="'+data.sections.imgurl+'"></div>').appendTo($('.swiper-wrapper'));*/
               if(data.prdMat.starnderdesc){
                    var stared = data.prdMat.starnderdesc;
                 }else{
                    var stared = '';
                }

                if(data.prdMat.price){
                    var prdmat = data.prdMat.price;
                }else {
                    var prdmat ='';
                }
                 var num = data.sections.discount * Number(10);

                 var price = Number(data.prdMat.price) * Number(data.sections.discount);
               
              if(data.sections.type == 2){
                $('<h2><em>'+data.supdetail.supname+'</em>'+data.prdMat.name+' '+stared+'</h2><div class="cl"><div class="price"><span price='+data.prdMat.nowprice+'>￥'+data.discountprice+'</span><span class="oldprice" price='+prdmat+'>￥'+prdmat+'</span><span class="zhekou">'+num.toFixed(1)+'折</span></div><div class="salenum">销量：'+countnum+'</div></div>'+'<div class="guige"><i>规格:</i></div>'+'<div class="baoyou"><a>正品保证</a><a>更专业</a><a>满<span>69.0</span>元包邮</a></div> ').appendTo($('.hy_detail'));
                  guige();

              } else if (data.sections.type == 1) {

                $('<h2><em>'+data.supdetail.supname+'</em>'+data.prdMat.name+' '+data.prdMat.starnderdesc+'</h2><div class="cl"><div class="price"><span price='+data.prdMat.nowprice+'>￥'+data.prdMat.nowprice+'</span><span class="oldprice"></span><span class="zhekou">'+data.sections.price+'折</span></div><div class="salenum">销量：'+countnum+'</div></div>'+'<div class="guige"><i>规格:</i></div>'+'<div class="baoyou"><a>正品保证</a><a>更专业</a><a>满<span>69.0</span>元包邮</a></div> ').appendTo($('.hy_detail'));
                guige();

              }else if(data.sections.type == 3){

                $('<h2 style="margin-bottom:.3rem;"><em>'+data.supdetail.supname+'</em>'+data.prdMat.name+' '+stared+'</h2><div class="cl"><div class="price"><span price='+data.sections.price+'>￥'+data.sections.price+'</span><span >￥'+prdmat+'</span><span class="zhekou"></span></div><div class="salenum">销量：'+countnum+'</div></div>'+'<div class="guige"><i>规格:</i></div>'+'<div class="baoyou"><a>正品保证</a><a>更专业</a><a>满<span>69.0</span>元包邮</a></div> ').appendTo($('.hy_detail'));
               
                guige();
              }
            }else{
               $('.add').attr('data',data.prdMat.prdid);
              $('#shop').attr('data',data.prdMat.prdid);
              $('#purchase').attr('data',data.prdMat.prdid);

              $('<h2><em>'+data.supdetail.supname+'</em>'+data.prdMat.name+' '+data.prdMat.starnderdesc+'</h2><div class="cl"><div class="price"><span price='+data.prdMat.nowprice+'>￥'+data.prdMat.nowprice+'</span><span>￥'+data.prdMat.price+'</span><span class="zhekou"></span></div><div class="salenum">销量：'+countnum+'</div></div>'+'<div class="guige"><i>规格:</i></div>'+'<div class="baoyou"><a>正品保证</a><a>更专业</a><a>满<span>69.0</span>元包邮</a></div> ').appendTo($('.hy_detail'));
              
                guige();
            }
            if($(".hy_detail h2 em").text()!="自营"){
              $(".hy_detail h2 em").text("非自营")
            }
            for(var i=0;i<data.unitlist.length;i++){
                if(data.unitlist[i].prdid == data.prdMat.prdid){
                    $(".guige span").eq(i).addClass("ggactive");
                }

            }
           //切换规格
            $(".guige span").on("click",function(){
              $(this).addClass("ggactive").siblings().removeClass("ggactive");
              var prdid = $(this).attr("data-prdid");
              history.replaceState(null, document.title, location.href.split("?")[0] + "?prdid="+prdid+"&num=0");
              location.reload();
            })

          
          //banner
           $.each(data.bannerimg,function(i,d){ //banner
             $('<div class="swiper-slide"><img src="'+d.imgurl+'"></div>').appendTo($('.swiper-wrapper'));
           }); 
           var mySwiper = new Swiper('.swiper-container',{//banner 轮播
      			  pagination : '.swiper-pagination'
      			});

           //图文
           $.each(data.declaresimg,function(n,b){
              $('<img src="'+b.imgurl+'">').appendTo($('.hy_Img'));
           });
          }
        }
    });

   // 获取 购物车 数量
   if(customerid != undefined){
     setTimeout(function(){
       $.post('/testback/prdCart/getCustomerCartCountList','info={customerid:"'+customerid+'"}',function(data){
          console.log(data)
         $('#purchase').attr('num',data.count);
         if(data.code == 0){
           if( data.count != 0){
             $('.num').text(data.count).show();
           } 
         }
      },'json');
     },500)
  }

    //返回

    $('.icon-return').on('click',function () {
      javascript:history.back();

    })

       //加入购物车
 $('.add').on('click',function () {

    var prdid = $(this).attr('data');
    var n=$('.num').text();
    if ( customerid ) {
       $.ajax({
        type : "post",
        url : "/testback/prdCart/addGoodsInCart", // 请求的地址
        data :"info={customerid:'"+customerid+"',prdid:'"+prdid+"',number:1}",
        dataType : "json",
        success : function(data){
           console.log(data)
           if(data.code == 0) { 
              n++;
              $('.num').text(n).show(); 
           }
        }
      });  
    } else if ( customerid == null || customerid == 'undefined' || customerid == 'none' || customerid == '') {
       location.href = 'oasis://login?url='+address+'&';
    }
});

</script>
</body>
</html>
